import{j as o}from"./query-DJ2Df_pl.js";import{C as w,a as R,S as U}from"./CreditsPage-Bwy9BWTM.js";import{d as A,n as T,g as G,O as L}from"./index-CtR4jyxL.js";import{R as B,C as K,a as N,X as $,Y as E,T as W,A as z,L as C,b as F,c as S}from"./charts-licedpqZ.js";import"./react-fVXvAP8Z.js";import"./login_background_2-B25p5Ake.js";import"./i18n-kcDNZBP3.js";A.div`
  height: 100%; 
  border: 1px dashed ${({theme:t})=>t.colors.borderLight};
  border-radius: 10px;
  display: grid;
  place-items: center;
  color: ${({theme:t})=>t.colors.textMuted};
`;const O=A(w).attrs({$padded:!0})`
  background: ${({theme:t})=>t.colors.tableHeadBackground};
`,p=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function y(t){return`${t.getUTCFullYear()}-${String(t.getUTCMonth()+1).padStart(2,"0")}`}function b(t){const[s,n]=t.split("-").map(Number);return new Date(Date.UTC(s,(n||1)-1,1))}function H(t){return b(t).toLocaleString("en-GB",{month:"short"})}function _(t){return!isFinite(t)||t===0?"0":t>=1e3?`${p.format(Math.round(t/1e3))}K`:p.format(t)}function I(t=[],s=[]){const n=new Map;for(const a of t){const i=y(a.x),e=n.get(i);n.set(i,{x:i,actual:a.y,forecast:e?.forecast??null})}for(const a of s){const i=y(a.x),e=n.get(i);n.set(i,{x:i,actual:e?.actual??null,forecast:a.y})}return n}function X(t){if(t.size===0)return[];const s=Array.from(t.keys()).sort(),n=s[0],a=s[s.length-1],i=[];let e=b(n);const l=b(a);for(;e<=l;){const d=y(e);i.push(t.get(d)??{x:d,actual:null,forecast:null}),e=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+1,1))}return i}function M({viewBox:t,text:s,fill:n,stroke:a,textColor:i,marginRight:e=180,offset:l=10}){const d=T(),f=i??d?.colors?.chart?.badgeText??"#1F2A37";if(!t)return null;const c=t.x??0,h=t.y??0,u=t.width??0,r=Math.max(96,18+s.length*7.2),x=24,m=c+u,D=m-14,v=m,g=m+l,j=h-x/2,k=m+e,Y=g+r>k?Math.max(70,k-g):r;return o.jsxs("g",{children:[o.jsx("line",{x1:D,y1:h,x2:v,y2:h,stroke:a,strokeWidth:2,opacity:.9}),o.jsx("rect",{x:g,y:j,width:Y,height:x,rx:8,ry:8,fill:n}),o.jsx("text",{x:g+10,y:j+16,fill:f,fontSize:12,fontWeight:700,children:s})]})}function V({active:t,label:s,payload:n,bg:a,text:i,border:e}){if(!t||!n)return null;const l=n.filter(r=>r.dataKey==="actual"||r.dataKey==="forecast").filter(r=>r.value!=null);if(!l.length)return null;const[d,f]=String(s??"").split("-").map(Number),h=new Date(Date.UTC(d||1970,(f||1)-1,1)).toLocaleString("en-GB",{month:"short",year:"numeric"}),u=r=>r==="forecast"?"Forecast":"Actual";return o.jsxs("div",{style:{background:a,color:i,border:`1px solid ${e}`,boxShadow:"0 2px 10px rgba(14, 30, 62, 0.08)",borderRadius:8,padding:"10px 12px"},children:[o.jsx("div",{style:{fontSize:12,opacity:.85,marginBottom:6},children:h}),l.map((r,x)=>o.jsxs("div",{style:{fontSize:13,lineHeight:"18px"},children:[o.jsx("span",{style:{color:r.color??i,fontWeight:700},children:u(r.dataKey)}),o.jsx("span",{children:`: ${p.format(Number(r.value))}`})]},x))]})}function q({actual:t=[],forecast:s=[],silverLevel:n=45e3,goldLevel:a=9e5}){const e=T()?.colors?.chart??{},l=I(t,s),f=X(l).map(r=>({...r,_fill:r.actual})),c=f.flatMap(r=>[r.actual??0,r.forecast??0,n,a]),h=Math.ceil(Math.max(1e3,...c)*1.1),u=95;return o.jsxs(O,{children:[o.jsx("h3",{children:"12 months spending forcast"}),o.jsx(R,{style:{height:320,overflow:"hidden"},children:o.jsx(B,{width:"100%",height:"100%",children:o.jsxs(K,{data:f,margin:{top:8,right:u,bottom:8,left:8},children:[o.jsx(N,{vertical:!1,stroke:e.grid||"#E9EDF6"}),o.jsx($,{dataKey:"x",type:"category",scale:"point",padding:{left:20,right:20},interval:0,minTickGap:0,tickMargin:10,tick:{fill:e.axis||"#7A8194",fontSize:12},tickFormatter:H,axisLine:!1,tickLine:!1}),o.jsx(E,{width:48,domain:[0,h],tickFormatter:r=>_(Number(r)),tick:{fill:e.axis||"#7A8194",fontSize:12},axisLine:!1,tickLine:!1}),o.jsx(W,{content:o.jsx(V,{bg:e.tooltipBg||"#FFFFFF",text:e.tooltipText||"#1F2A37",border:e.tooltipBorder||"#E6E9F2"})}),o.jsx("defs",{children:o.jsxs("linearGradient",{id:"spendFill",x1:"0",y1:"0",x2:"0",y2:"1",children:[o.jsx("stop",{offset:"0%",stopColor:e.areaTop||"rgba(30, 42, 116, 0.25)"}),o.jsx("stop",{offset:"100%",stopColor:e.areaBottom||"rgba(30, 42, 116, 0.04)"})]})}),o.jsx(z,{type:"monotone",dataKey:"_fill",stroke:"none",fill:"url(#spendFill)",isAnimationActive:!1,connectNulls:!1}),o.jsx(C,{type:"monotone",dataKey:"actual",stroke:e.lineActual||"#24357C",strokeWidth:4,dot:!1,isAnimationActive:!1,connectNulls:!1,name:"Actual"}),o.jsx(C,{type:"monotone",dataKey:"forecast",stroke:e.lineForecast||"#24357C",strokeWidth:4,strokeDasharray:e.dash||"8 8",dot:!1,isAnimationActive:!1,connectNulls:!1,name:"Forecast"}),o.jsx(F,{y:a,stroke:e.badgeGold||"#E7B53A",strokeWidth:2,strokeOpacity:.9,ifOverflow:"extendDomain",label:o.jsx(S,{component:o.jsx(M,{text:"Gold partner",fill:e.badgeGold||"#E7B53A",stroke:e.badgeGold||"#E7B53A",marginRight:u,offset:10})})}),o.jsx(F,{y:n,stroke:e.badgeSilver||"#6D6F76",strokeWidth:2,strokeOpacity:.75,ifOverflow:"extendDomain",label:o.jsx(S,{component:o.jsx(M,{text:"Silver partner",fill:e.badgeSilver||"#6D6F76",stroke:e.badgeSilver||"#6D6F76",marginRight:u,offset:10})})})]})})})]})}function J(t){return t?.length?t.map(s=>({x:new Date(Date.UTC(s.year??1970,(s.month??1)-1,1)),y:Number(s.amountSpent??0)})).sort((s,n)=>s.x.getTime()-n.x.getTime()):[]}function P(t,s=12,n=3){if(!t.length)return[];const a=t.map(c=>c.y),i=t[t.length-1].x,e=c=>new Date(Date.UTC(c.getUTCFullYear(),c.getUTCMonth()+1,1));let l=e(i);const d=[],f=a.slice(-n);for(;f.length<n;)f.unshift(0);for(let c=0;c<s;c++){const h=a.length>=n?a.slice(-n):f.slice(-n),u=h.reduce((r,x)=>r+x,0)/(h.length||1);d.push({x:l,y:Math.max(0,u)}),a.push(u),l=e(l)}return d}function rt(){const{data:t,isLoading:s}=G(L);if(s&&!t)return o.jsx(U,{});const n=J(t?.history),a=P(n,12,3);return o.jsx(q,{actual:n,forecast:a})}export{rt as default};
